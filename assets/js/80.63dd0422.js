(window.webpackJsonp=window.webpackJsonp||[]).push([[80],{567:function(s,a,t){"use strict";t.r(a);var n=t(29),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"通过-pnpm-workspaces-创建-monorepo-并使用-nx-加速"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#通过-pnpm-workspaces-创建-monorepo-并使用-nx-加速"}},[s._v("#")]),s._v(" 通过 PNPM workspaces 创建 Monorepo 并使用 Nx 加速！")]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),a("p",[s._v("* 原文："),a("a",{attrs:{href:"https://blog.nrwl.io/setup-a-monorepo-with-pnpm-workspaces-and-speed-it-up-with-nx-bc5d97258a7e",target:"_blank",rel:"noopener noreferrer"}},[s._v("Setup a Monorepo with PNPM workspaces and speed it up with Nx!"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("* 作者："),a("a",{attrs:{href:"https://medium.com/@juristr",target:"_blank",rel:"noopener noreferrer"}},[s._v("Juri Strumpflohner"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("* 翻译："),a("a",{attrs:{href:"https://fengnzl.github.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("城南花已开"),a("OutboundLink")],1)])]),s._v(" "),a("p",[s._v("我们将学习如何使用PNPM运行命令,如何并行运行它们,最后我们将添加Nx以实现更复杂的任务调度")]),s._v(" "),a("p",[s._v("在本篇文章，我们将深入谈到如何使用 "),a("a",{attrs:{href:"https://pnpm.io/workspaces",target:"_blank",rel:"noopener noreferrer"}},[s._v("PNPM workspaces"),a("OutboundLink")],1),s._v(" 创建新的 monorepo， 该工作区包含一个 Remix 应用和一个基于 React 的库。我们将学习如何使用 PNPM 运行命令，如何并行运行它们，最后我们将添加 Nx 来实现更复杂的任务调度，包括命令缓存等等。")]),s._v(" "),a("p",[a("strong",[s._v("重要：")]),s._v(" 如果你已经对 PNPM workspaces 的创建和配置非常熟悉，请直接跳转到文章末尾 Nx 部分。")]),s._v(" "),a("p",[a("strong",[s._v("更喜欢实战视频？")])]),s._v(" "),a("iframe",{attrs:{width:"692",height:"389",src:"https://www.youtube.com/embed/ngdoUQBvAjo",title:"Setup a monorepo with PNPM workspaces and add Nx for speed",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:""}}),s._v(" "),a("h2",{attrs:{id:"初始化一个新的-pnpm-workspaces"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#初始化一个新的-pnpm-workspaces"}},[s._v("#")]),s._v(" 初始化一个新的 PNPM workspaces")]),s._v(" "),a("p",[s._v("开始之前，请先确保你已安装了 PNPM。官方文档"),a("a",{attrs:{href:"https://pnpm.io/installation",target:"_blank",rel:"noopener noreferrer"}},[s._v("安装页面"),a("OutboundLink")],1),s._v("有详细的说明。我同时也推荐使用类似 "),a("a",{attrs:{href:"https://volta.sh/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Volta"),a("OutboundLink")],1),s._v(" 的工具，特别是当你需要处理多个不同的 NPM/PNPM 和 node 版本的时候。")]),s._v(" "),a("p",[s._v("让我们创建一个名为 "),a("code",[s._v("pnpm-mono")]),s._v(" 的文件夹，cd 进入，然后运行 "),a("code",[s._v("pnpm init")]),s._v(" 命令生成一个顶层的 "),a("code",[s._v("package.json")]),s._v(" 文件。这将是我们 PNPM moonorepo 项目的 root "),a("code",[s._v("package.json")]),s._v("。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("❯ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" pnpm-mono\n❯ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" pnpm-mono\n❯ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("pnpm")]),s._v(" init\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("初始化一个新的 Git 仓库也许会很方便，这样我们就可以在设置过程中提交和备份内容。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("❯ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" init\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("现在，我们还需要创建一个 "),a("code",[s._v(".gitignore")]),s._v(" 文件，从而立刻可以排除类似 "),a("code",[s._v("node_modules")]),s._v(" 和通用构建输出文件夹等内容。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# .gitignore\nnode_modules\ndist\nbuild\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h2",{attrs:{id:"设置-monorepo-结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#设置-monorepo-结构"}},[s._v("#")]),s._v(" 设置 Monorepo 结构")]),s._v(" "),a("p",[s._v("Monorepo 的结构通常与你打算使用它的目的而有所不同。以下是常用的两种目录结构：")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("package centric")]),s._v(" 用于开发和发布一套可重复使用的软件包。这在开源世界中很常见的一种设置，可以在诸如 "),a("a",{attrs:{href:"https://github.com/angular/angular",target:"_blank",rel:"noopener noreferrer"}},[s._v("Angular"),a("OutboundLink")],1),s._v("，"),a("a",{attrs:{href:"https://github.com/facebook/react",target:"_blank",rel:"noopener noreferrer"}},[s._v("React"),a("OutboundLink")],1),s._v("，"),a("a",{attrs:{href:"https://github.com/vuejs/vue",target:"_blank",rel:"noopener noreferrer"}},[s._v("Vue"),a("OutboundLink")],1),s._v(" 及其他许多仓库中可以看到。这些 repos 的特点是通常具有一个 "),a("code",[s._v("packages")]),s._v(" 文件夹，并且通常会发布到类似 "),a("a",{attrs:{href:"https://www.npmjs.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("NPM"),a("OutboundLink")],1),s._v(" 的公共注册中心。")]),s._v(" "),a("li",[a("strong",[s._v("app centric")]),s._v(" 主要用于开发应用程序和产品的仓库。这在公司中是一种常见的设置。这些 repos 的特点是拥有 "),a("code",[s._v("apps")]),s._v(" 和 "),a("code",[s._v("packages")]),s._v(" 或者 "),a("code",[s._v("libs")]),s._v(" 文件夹，其中 "),a("code",[s._v("apps")]),s._v(" 文件夹里面包括可构建和可部署的应用，而 "),a("code",[s._v("packages")]),s._v(" 和 "),a("code",[s._v("libs")]),s._v(" 文件夹包含特定于 monorepo 中正在开发的一个或者多个应用程序的库。你仍然可以将其中一些 libs 发布到公共注册中心。")])]),s._v(" "),a("p",[s._v("在这篇文章，我们将使用 "),a("code",[s._v("app centric")]),s._v(" 的方法，演示如何让应用程序从 monorepo 中使用 packages。")]),s._v(" "),a("p",[s._v("在 "),a("code",[s._v("pnpm-mono")]),s._v(" 文件夹中创建 "),a("code",[s._v("apps")]),s._v(" 和 "),a("code",[s._v("packages")]),s._v(" 文件夹：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("❯ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" apps packages\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("现在让我们来配置 PNPM 以正确识别 monorepo 工作区。基本上，我们需要在 repository 的根目录下创建一个 "),a("code",[s._v("pnpm-workspace.yaml")]),s._v(" 文件，定义 monorepo 的结构：")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pnpm-workspace.yaml")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("packages")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# executable/launchable applications")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'apps/*'")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# all packages in subdirs of packages/ and components/")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'packages/*'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h2",{attrs:{id:"添加-remix-应用程序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#添加-remix-应用程序"}},[s._v("#")]),s._v(" 添加 Remix 应用程序")]),s._v(" "),a("p",[s._v("现在我们已经完成了添加第一个应用的准备工作。我将选择 "),a("a",{attrs:{href:"https://remix.run/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Remix"),a("OutboundLink")],1),s._v(" 作为示例，但是你可以选择任意类型的应用，这并不重要：")]),s._v(" "),a("blockquote",[a("p",[s._v("提示： 我们将使用正常的 "),a("a",{attrs:{href:"https://remix.run/docs/en/v1",target:"_blank",rel:"noopener noreferrer"}},[s._v("Remix 安装和设置过程"),a("OutboundLink")],1),s._v("，你可以在它们的文档页面找到这些。")])]),s._v(" "),a("p",[s._v("因为我们希望 app 在 "),a("code",[s._v("apps")]),s._v(" 文件夹中，我们需要 "),a("code",[s._v("cd")]),s._v(" 进入文件夹：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("❯ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" apps\n❯ npx create-remix@latest\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("你将会被要求输入应用名称。让我们使用 “my-remix-app”，我们将在这篇文章的后续部分用到它。显然，你可以取一个不同的名称。此外， Remix 设置过程会询问一些问题，以自定义确切的设置。这些特定选项与本文无关，所以您可以随意选择最适合您需求的选项。")]),s._v(" "),a("p",[s._v("现在你拥有了一个 Remix 应用，在 "),a("code",[s._v("apps/my-remix-app")]),s._v(" 文件夹下或者你自己选取的名称。Remix 已经有一个 "),a("code",[s._v("package.json")]),s._v(" 文件以及相应的脚本配置：")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"private"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"sideEffects"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"scripts"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"build"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"remix build"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"dev"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"remix dev"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"start"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"remix-serve build"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  ...\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("通常，在一个 monorepo 中你想在仓库的根目录下执行命令而不是在文件夹中不断切换。 PNPM 工作区已经有方法可以实现上述操作，只需要一个 "),a("code",[s._v("filter")]),s._v(" 参数，例如：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("❯ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("pnpm")]),s._v(" --filter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("-F"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("package-name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("command"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("现在（在本文的编写时），Remix 的默认 "),a("code",[s._v("pacakge.json")]),s._v(" 文件中没有定义 PNPM 需要运行该包的 "),a("code",[s._v("name")]),s._v(" 属性。因此，让我们在 "),a("code",[s._v("apps/my-remix-app/package.json")]),s._v(" 文件中定义一个：")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-remix-app"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"private"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"sideEffects"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  ...\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("你可以通过以下命令在 dev 模式下运行 Remix 应用服务：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("❯ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("pnpm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--filter")]),s._v(" my-remix-app dev\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/fengnzl/HexoImages/master/blog/20221003181628.png",alt:"remix-serve"}})]),s._v(" "),a("h2",{attrs:{id:"创建一个共享-ui-库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建一个共享-ui-库"}},[s._v("#")]),s._v(" 创建一个共享 UI 库")]),s._v(" "),a("p",[s._v("现在我们设置了我们的应用，让我们来创建一个可以被应用使用的 library package。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("❯ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" packages\n❯ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" shared-ui\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("下一步，让我们创建一个拥有以下内容的 "),a("code",[s._v("package.json")]),s._v(" 文件（你也可以可以使用 "),a("code",[s._v("pnpm init")]),s._v(" 创建，然后进行修改）：")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"private"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"shared-ui"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"description"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Shared UI components"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"scripts"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"keywords"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"author"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"license"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ISC"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"dependencies"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"devDependencies"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("注意，我们声明它为 "),a("code",[s._v("private")]),s._v(" 是因为我们不想将其发布到 NPM 或者其他地方，而只是在我们的工作区本地中进行引用和使用。我还删除了 "),a("code",[s._v("version")]),s._v(" 属性，因为它没有被用到。")]),s._v(" "),a("p",[s._v("作为技术栈，我选择使用 React(这样可以在 Remix 中使用) 和 Typescript(因为现今它被认为是标准)。让我们在工作区的根目录下安装这些依赖。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("❯ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("pnpm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--filter")]),s._v(" shared-ui "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" react\n❯ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("pnpm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--filter")]),s._v(" shared-ui "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" typescript "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-D")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("通过在安装命令中传入 "),a("code",[s._v("--filter shared-ui")]),s._v("，我们可以将这些 NPM 包本地安装到 "),a("code",[s._v("shared-ui")]),s._v(" 库中。")]),s._v(" "),a("blockquote",[a("p",[s._v("提示：请注意这可能导致版本冲突如果我们库的 React/Typescript 版本与使用者（如我们的应用）的版本不同。采用"),a("a",{attrs:{href:"https://opensource.google/documentation/reference/thirdparty/oneversion",target:"_blank",rel:"noopener noreferrer"}},[s._v("单一版本策略"),a("OutboundLink")],1),s._v("，将包移动到 monorepo 的根目录，是一个可能的解决方案。")])]),s._v(" "),a("p",[s._v("我们第一个组件是一个非常简单的 "),a("code",[s._v("Button")]),s._v(" 组件。因此，我们来创建一个吧：")]),s._v(" "),a("div",{staticClass:"language-tsx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-tsx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// packages/shared-ui/Button.tsx")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Button")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("props"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("any")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("button")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("onClick")]),a("span",{pre:!0,attrs:{class:"token script language-javascript"}},[a("span",{pre:!0,attrs:{class:"token script-punctuation punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" props"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("onClick")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("props"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("children"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("button")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" Button"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("我们同样希望有一个公共 API，可以用来导出组件，以便在 "),a("code",[s._v("shared-ui")]),s._v(" 外部使用。")]),s._v(" "),a("div",{staticClass:"language-tsx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-tsx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// packages/shared-ui/index.tsx")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./Button'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("为了方便起见，我们只是使用 Typescript 编译器来编译我们的组件。我们可以使用一些更复杂的配置将多个文件打包在一起，如 Rollup 或者其他你使用的构建工具，但这超出了本文的范围。")]),s._v(" "),a("p",[s._v("为了创建所需要的编译输出，我们需要创建 "),a("code",[s._v("packages/shared-ui/tsconfig.json")]),s._v(" 文件并添加如下配置：")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"compilerOptions"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"jsx"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"react-jsx"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"allowJs"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"esModuleInterop"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"allowSyntheticDefaultImports"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"module"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"commonjs"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"outDir"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./dist"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"include"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"."')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"exclude"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dist"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node_modules"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"**/*.spec.ts"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("blockquote",[a("p",[s._v("在 monorepo 中，最好的做法是将公共配置抽离到更高一层的配置中（如根目录中），然后再各个项目中去扩展它。这是为了避免各种 monorepo 包中的大量重复。为了方便起见，我把它们都放在了一个地方。")])]),s._v(" "),a("p",[s._v("正如你所见， "),a("code",[s._v("outDir")]),s._v(" 指向本地包的 "),a("code",[s._v("dist")]),s._v(" 文件夹。因此我们应该在 "),a("code",[s._v("shared-ui")]),s._v(" 的 "),a("code",[s._v("package.json")]),s._v(" 文件中添加主入口点。")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"private"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"shared-ui"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"main"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dist/index.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("最后，实际的打包包括删除之前打包是创建的文件夹及执行 Typescript 编译器（tsc）。以下是 "),a("code",[s._v("packages/shared-ui/package.json")]),s._v(" 完整文件。")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"private"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"shared-ui"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"description"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Shared UI components"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"main"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dist/index.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"scripts"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"build"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rm -rf dist && tsc"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"keywords"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"author"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"license"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ISC"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"dependencies"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"react"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^17.0.2"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"devDependencies"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"typescript"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^4.6.4"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("p",[s._v("在 PNPM 工作区的根目录下运行以下命令来执行打包：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("❯ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("pnpm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--filter")]),s._v(" shared-ui build\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("如果构建成功，你会在 "),a("code",[s._v("packages/shared-ui/dist")]),s._v(" 文件夹中看到编译的输出。")]),s._v(" "),a("h2",{attrs:{id:"在-remix-应用中使用我们的-shared-ui-包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在-remix-应用中使用我们的-shared-ui-包"}},[s._v("#")]),s._v(" 在 Remix 应用中使用我们的 shared-ui 包")]),s._v(" "),a("p",[s._v("我们的 "),a("code",[s._v("shared-ui")]),s._v(" 库已经准备好了，因此我们可以在 "),a("code",[s._v("apps")]),s._v(" 中的 Remix 应用中使用它。我们可以在 Remix 应用的 "),a("code",[s._v("package.json")]),s._v(" 文件中手动添加依赖或者通过 PNPM 添加：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("❯ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("pnpm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--filter")]),s._v(" my-remix-app "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" shared-ui "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--workspace")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("这将会在 "),a("code",[s._v("apps/my-remix-app/package.json")]),s._v(" 文件中添加依赖：")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-remix-app"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"private"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"sideEffects"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  ...\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"dependencies"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    ...\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"shared-ui"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"workspace:*"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  ...\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[a("code",[s._v("workspace:*")]),s._v(" 表明该包是在工作区本地进行解析的，而不是从一些远程注册中心（如 "),a("a",{attrs:{href:"https://www.npmjs.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("NPM"),a("OutboundLink")],1),s._v("）解析。"),a("code",[s._v("*")]),s._v(" 简单的表示我们希望依赖于其最新版本，而不是特定的版本。如果你使用的是外部 NPM 包，那么使用特定的版本号是有意义的。")]),s._v(" "),a("p",[s._v("为了使用 "),a("code",[s._v("Button")]),s._v(" 组件，我们需要在 Remix 一些路由中导入。将 "),a("code",[s._v("apps/my-remix-app/app/routes/index.tsx")]),s._v(" 中的内容替换如下：")]),s._v(" "),a("div",{staticClass:"language-tsx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-tsx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// apps/my-remix-app/app/routes/index.tsx")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" Button "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'shared-ui'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Index")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token plain-text"}},[s._v("\n      ")]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Button")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("onClick")]),a("span",{pre:!0,attrs:{class:"token script language-javascript"}},[a("span",{pre:!0,attrs:{class:"token script-punctuation punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("console")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'clicked'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token plain-text"}},[s._v("Click me")]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Button")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token plain-text"}},[s._v("\n    ")]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("现在如果你重新运行 Remix 应用，你将会看到 button 被渲染。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("❯ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("pnpm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--filter")]),s._v(" my-remix-app dev\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("如果你遇到如下错误，说明你需要先构建 "),a("code",[s._v("shared-ui")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("Error: Cannot "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" module "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/Users/juri/nrwl/content/pnpm-demos/pnpm-mono/apps/my-remix-app/node_modules/shared-ui/dist/index.js'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" Please verify that the package.json has a valid "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"main"')]),s._v(" entry  \n    at tryPackage "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("node:internal/modules/cjs/loader:353:19"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  \n    at Function.Module._findPath "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("node:internal/modules/cjs/loader:566:18"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  \n    at Function.Module._resolveFilename "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("node:internal/modules/cjs/loader:919:27"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  \n    at Function.Module._load "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("node:internal/modules/cjs/loader:778:27"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  \n    at Module.require "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("node:internal/modules/cjs/loader:1005:19"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  \n    at require "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("node:internal/modules/cjs/helpers:102:18"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  \n    at Object."),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("anonymous"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/Users/juri/nrwl/content/pnpm-demos/pnpm-mono/apps/my-remix-app/app/routes/index.tsx:1:24"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  \n    at Module._compile "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("node:internal/modules/cjs/loader:1105:14"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  \n    at Object.Module._extensions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("js "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("node:internal/modules/cjs/loader:1159:10"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  \n    at Module.load "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("node:internal/modules/cjs/loader:981:32"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("要构建它，请运行")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("❯ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("pnpm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--filter")]),s._v(" shared-ui build\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("为什么？这是因为引用和解析本地依赖 PNPM 创建的符号连接。通过在 Remix 应用的 "),a("code",[s._v("package.json")]),s._v(" 文件中 添加 "),a("code",[s._v('shared-ui: "workspace:*"')]),s._v("，你指示 PNPM 将软连接添加到 Remix 的 "),a("code",[s._v("node_modules")]),s._v(" 文件夹中。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/fengnzl/HexoImages/master/blog/20221003200445.png",alt:"symlink"}})]),s._v(" "),a("h2",{attrs:{id:"通过-pnpm-运行命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#通过-pnpm-运行命令"}},[s._v("#")]),s._v(" 通过 PNPM 运行命令")]),s._v(" "),a("p",[s._v("PNPM 提供了一些方便的特性，在 monorepo 工作区中运行命令。我们已经看到如何通过 "),a("code",[s._v("--filter")]),s._v(" 在特定的包上使用命令。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("❯ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("pnpm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--filter")]),s._v(" my-remix-app dev\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("你同样可以通过 "),a("code",[s._v("-r")]),s._v(" 标志在工作区中所有的包中递归运行一个命令。假如为所有的项目运行构建命令。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("❯ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("pnpm")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-r")]),s._v(" build\nScope: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" of "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" workspace projects\npackages/shared-ui build$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rf")]),s._v(" dist "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" tsc\n└─ Done "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" 603ms\napps/my-remix-app build$ remix build\n│ Building Remix app "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" production mode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n│ The path "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"shared-ui"')]),s._v(" is imported "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" app/routes/index.tsx but shared-ui is not listed "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" your package.json \n│ Built "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" 156ms\n└─ Done "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" 547ms\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("类似的，你可以通过 "),a("code",[s._v("--parallel")]),s._v(" 并行的运行命令")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("❯ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("pnpm")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--parallel")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-r")]),s._v(" build\nScope: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" of "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" workspace projects\napps/my-remix-app build$ remix build\npackages/shared-ui build$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rf")]),s._v(" dist "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" tsc\napps/my-remix-app build: Building Remix app "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" production mode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\napps/my-remix-app build: The path "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"shared-ui"')]),s._v(" is imported "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" app/routes/index.tsx but shared-ui is not listed "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" your package.json dependencies. Did you forget to "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" it?\napps/my-remix-app build: Built "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" 176ms\napps/my-remix-app build: Done\npackages/shared-ui build: Done\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h2",{attrs:{id:"通过-nx-加速"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#通过-nx-加速"}},[s._v("#")]),s._v(" 通过 Nx 加速")]),s._v(" "),a("p",[s._v("PNPM 工作区提供了一些基本的功能，在 monorepo 包中运行任务，甚至是并行。随着 monorepo 的增长，你或许想要一个更加复杂的方法可以执行以下操作：")]),s._v(" "),a("ul",[a("li",[s._v("只有在包内容改变的时候才会运行任务")]),s._v(" "),a("li",[s._v("根据文件内容的高级缓存，不运行之前已经计算过的任何内容")]),s._v(" "),a("li",[s._v("远程分布式缓存以加速 CI")])]),s._v(" "),a("p",[s._v("这正是 "),a("a",{attrs:{href:"https://nx.dev/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Nx"),a("OutboundLink")],1),s._v(" 可以提供帮助的地方。它针对 monorepo 场景进行了优化，并带有高级任务调度机制。我们仍然依赖 PNPM 提供的安装包和包链接机制，但是通过 Nx 来更加高效的运行我们的任务。")]),s._v(" "),a("h2",{attrs:{id:"安装-nx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装-nx"}},[s._v("#")]),s._v(" 安装 Nx")]),s._v(" "),a("p",[s._v("由于 "),a("a",{attrs:{href:"https://nx.dev/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Nx"),a("OutboundLink")],1),s._v(" 将在整个 monorepo 工作区中运行操作，我们将其安装在根目录的 "),a("code",[s._v("package.json")]),s._v(" 中。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("❯ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("pnpm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" nx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-D")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-w")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("就这样。")]),s._v(" "),a("h2",{attrs:{id:"通过-nx-运行命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#通过-nx-运行命令"}},[s._v("#")]),s._v(" 通过 Nx 运行命令")]),s._v(" "),a("p",[s._v("Nx 通过以下形式运行你的命令：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("❯ npx nx "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("target"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("project"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("code",[s._v("taget")]),s._v(" 是特定情况下你想要执行的 NPM 脚本。\n让我们试着运行以下命令来打包 "),a("code",[s._v("shared-ui")]),s._v(" 包：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("❯ npx nx build shared-ui\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("这会产生以下输出")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" nx run shared-ui:build\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" shared-ui@ build /Users/juri/nrwl/content/pnpm-demos/pnpm-mono/packages/shared-ui\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rf")]),s._v(" dist "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" tsc\n "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  NX   Successfully ran target build "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" project shared-ui "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("1s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("Nx 自动找到 "),a("code",[s._v("shared-ui")]),s._v(" 并且执行 "),a("code",[s._v("packages/shared-ui/pacakge.json")]),s._v(" 文件中定义的 "),a("code",[s._v("build")]),s._v(" 脚本。")]),s._v(" "),a("p",[s._v("类似的，要启动我们的 Remix 应用，运行 "),a("code",[s._v("npx nx dev my-remix-app")]),s._v("。")]),s._v(" "),a("p",[s._v("我们同样可以在跨项目中并行执行命令：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("❯ npx nx run-many "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--target")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("build "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--all")]),s._v("\n    ✔  nx run my-remix-app:build "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("1s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    ✔  nx run shared-ui:build "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("1s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  NX   Successfully ran target build "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" projects "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("1s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("或选择特定的项目")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("❯ npx nx run-many "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--target")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("build "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--projects")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("my-remix-app,shared-ui\n    ✔  nx run my-remix-app:build "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("1s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    ✔  nx run shared-ui:build "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("1s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  NX   Successfully ran target build "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" projects "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("1s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("blockquote",[a("p",[s._v("注意我用 "),a("code",[s._v("npx")]),s._v(" 作为命令的前缀，该命令在 "),a("code",[s._v("node_modules")]),s._v(" 文件夹中 Nx 可执行文件。这样我就不用全局安装 "),a("code",[s._v("nx")]),s._v("，如果你更喜欢全局方式，请随意。")])]),s._v(" "),a("h2",{attrs:{id:"配置缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置缓存"}},[s._v("#")]),s._v(" 配置缓存")]),s._v(" "),a("p",[s._v("将 Nx 添加到 PNPM 工作区的一个主要好处是"),a("strong",[s._v("通过缓存提高速度")]),s._v("。"),a("a",{attrs:{href:"https://nx.dev/concepts/how-caching-works#computation-caching",target:"_blank",rel:"noopener noreferrer"}},[s._v("计算缓存"),a("OutboundLink")],1),s._v("是一种收集不同输入(源文件、环境变量、命令标志等)并计算哈希,将其存储在本地文件夹中的特性。当下一次你运行命令的时候，Nx 会寻找匹配的 hash，如果找到则恢复它。这包括恢复终端输出及构建制品（如 "),a("code",[s._v("dist")]),s._v(" 文件夹中的 JS 文件）。")]),s._v(" "),a("p",[s._v("并非所有操作都可以缓存,只有无副作用的操作可以缓存。例如，如果您运行具有相同输入的操作，它总是可靠的产生相同的输出。如果在执行的命令中调用了一些 API，那么它将无法缓存，因为给定相同的输入参数，API执行的结果可能会有所不同。")]),s._v(" "),a("p",[s._v("为了开启缓存，让我们来配置可以缓存的操作。为此我们在工作区的根目录创建 "),a("code",[s._v("nx.json")]),s._v(" 文件，并添加以下内容。")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// nx.json")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"tasksRunnerOptions"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"default"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"runner"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nx/tasks-runners/default"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"options"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"cacheableOperations"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"build"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("注意我们在 "),a("code",[s._v("cacheableOperations")]),s._v(" 数组中指定了 "),a("code",[s._v("build")]),s._v(" 和 "),a("code",[s._v("test")]),s._v("。你可以添加更多的操作如 "),a("code",[s._v("linting")]),s._v("。")]),s._v(" "),a("p",[s._v("启用了这个，如果我们第一次运行 Remix 应用构建，那么可以看到跟往常一样，大概需要 1 秒钟。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("❯ npx nx build my-remix-app\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" nx run my-remix-app:build\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" my-remix-app@ build /Users/juri/nrwl/content/pnpm-demos/pnpm-mono/apps/my-remix-app\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" remix build\nBuilding Remix app "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" production mode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nThe path "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"shared-ui"')]),s._v(" is imported "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" app/routes/index.tsx but shared-ui is not listed "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" your package.json dependencies. Did you forget to "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" it?\nBuilt "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" 163ms\n "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  NX   Successfully ran target build "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" project my-remix-app "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("1s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("如果你重新运行同样的命令，它现在将会从缓存中领取，并只需要几毫秒。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("❯ npx nx build my-remix-app\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" nx run my-remix-app:build  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("existing outputs match the cache, left as is"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" my-remix-app@ build /Users/juri/nrwl/content/pnpm-demos/pnpm-mono/apps/my-remix-app\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" remix build\nBuilding Remix app "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" production mode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nThe path "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"shared-ui"')]),s._v(" is imported "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" app/routes/index.tsx but shared-ui is not listed "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" your package.json dependencies. Did you forget to "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" it?\nBuilt "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" 163ms\n "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  NX   Successfully ran target build "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" project my-remix-app "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("9ms"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nNx "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" the output from the cache instead of running the "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" out of "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" tasks.\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("你可以在终端输出中看到如下提示 “existing outputs match the cache, left as is” 以及在末尾看到 “Nx read the output from the cache instead of running the command for 1 out of 1 tasks.”")]),s._v(" "),a("p",[s._v("适当的缓存可以极大的提升命令的运行时间。如果缓存是远程分布的，它也可以与 CI 的其他开发任务人员机器共享，那么这也将变得更加有用。就 Nx 而言，可以通过 "),a("a",{attrs:{href:"https://nx.dev/nx-cloud/set-up/set-up-caching",target:"_blank",rel:"noopener noreferrer"}},[s._v("Nx Cloud"),a("OutboundLink")],1),s._v(" 实现，他将每月免费（无需信用卡）可节省 500h/M 和开源项目的无限时间。")]),s._v(" "),a("h2",{attrs:{id:"精细调整缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#精细调整缓存"}},[s._v("#")]),s._v(" 精细调整缓存")]),s._v(" "),a("p",[s._v("默认情况下，缓存机制将所有"),a("a",{attrs:{href:"https://nx.dev/concepts/how-caching-works#source-code-hash-inputs",target:"_blank",rel:"noopener noreferrer"}},[s._v("项目级文件作为输入"),a("OutboundLink")],1),s._v("。我们可能想要根据执行的目标来区分哪些文件正在被考虑。例如：如果只更改了单元测试的规范文件，你可能不希望使构建任务的缓存失效。")]),s._v(" "),a("p",[s._v("为了在我们的示例中说明这一点，运行 "),a("code",[s._v("npx nx build my-remix-app")]),s._v(" 两次，这样缓存就会被激活。下一步，改变 Remix 项目的 "),a("code",[s._v("READEME.md")]),s._v("（"),a("code",[s._v("apps/my-remix-app/READEME.md")]),s._v("） 文件。如果你再次构建 Remix 应用可以发现由于 README 文件的改动缓存失效了。这可能并不是期望的操作。")]),s._v(" "),a("p",[s._v("我们可以精细调整缓存，通过在 "),a("code",[s._v("nx.json")]),s._v(" 文件中添加 "),a("code",[s._v("targetDefaults")]),s._v(" 节点，然后定义 "),a("code",[s._v("build")]),s._v(" 目标默认 "),a("code",[s._v("input")]),s._v(" 应该排除的 "),a("code",[s._v("*md")]),s._v(" 文件。")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"tasksRunnerOptions"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"default"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"runner"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nx/tasks-runners/default"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"options"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"cacheableOperations"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"build"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"targetDefaults"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"build"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"inputs"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"!{projectRoot}/**/*.md"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[s._v("通过这个改动，MD 文件的变化将不会作为缓存输入的一部分，无论何时运行 "),a("code",[s._v("build")]),s._v(" 任务。")]),s._v(" "),a("blockquote",[a("p",[s._v("注意所有路径的 globs 都相对于工作区的根目录而言。这样可以避免混淆，因为输入可以在 "),a("code",[s._v("packages.json")]),s._v("（"),a("a",{attrs:{href:"https://nx.dev/reference/project-configuration",target:"_blank",rel:"noopener noreferrer"}},[s._v("更多细节"),a("OutboundLink")],1),s._v("）中进行项目级别的定义。你可以通过插值变量 "),a("code",[s._v("{projectRoot}")]),s._v(" 和 "),a("code",[s._v("{workspaceRoot}")]),s._v(" 来区分路径是针对项目特定文件还是工作区级别的文件。")])]),s._v(" "),a("h2",{attrs:{id:"重用-globs-缓存输入"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#重用-globs-缓存输入"}},[s._v("#")]),s._v(" 重用 Globs 缓存输入")]),s._v(" "),a("p",[s._v("你还可以更进一步，你可以重用这个 glob 来排除一个假设 "),a("code",[s._v("test")]),s._v("目标中的 markdown 文件。你可以通过将 glob 提取到 "),a("code",[s._v("namedInputs")]),s._v(" 属性来实现这点。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tasksRunnerOptions"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"namedInputs"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"noMarkdown"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"!{projectRoot}/**/*.md"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"targetDefaults"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"build"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"inputs"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"noMarkdown"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^noMarkdown"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"inputs"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"noMarkdown"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^noMarkdown"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("p",[s._v("通过在 "),a("code",[s._v("namedInput")]),s._v(" 前添加 "),a("code",[s._v("^")]),s._v(" 表明这个改变同样应用于项目中的任何依赖的更改。")]),s._v(" "),a("h2",{attrs:{id:"定义任务依赖-即构建流水线"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#定义任务依赖-即构建流水线"}},[s._v("#")]),s._v(" 定义任务依赖（即构建流水线）")]),s._v(" "),a("p",[s._v("我们先前已经看到当运行 Remix 开发服务，但是在这之前没有编译依赖的 "),a("code",[s._v("shared-ui")]),s._v(" 包，我们会在运行的时候得到以下错误：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("Error: Cannot "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" module "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/Users/juri/nrwl/content/pnpm-demos/pnpm-mono/apps/my-remix-app/node_modules/shared-ui/dist/index.js'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" Please verify that the package.json has a valid "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"main"')]),s._v(" entry  \n    at tryPackage "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("node:internal/modules/cjs/loader:353:19"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  \n    at Function.Module._findPath "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("node:internal/modules/cjs/loader:566:18"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  \n    at Function.Module._resolveFilename "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("node:internal/modules/cjs/loader:919:27"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  \n    at Function.Module._load "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("node:internal/modules/cjs/loader:778:27"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  \n    at Module.require "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("node:internal/modules/cjs/loader:1005:19"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  \n    at require "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("node:internal/modules/cjs/helpers:102:18"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  \n    at Object."),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("anonymous"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/Users/juri/nrwl/content/pnpm-demos/pnpm-mono/apps/my-remix-app/app/routes/index.tsx:1:24"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  \n    at Module._compile "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("node:internal/modules/cjs/loader:1105:14"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  \n    at Object.Module._extensions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("js "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("node:internal/modules/cjs/loader:1159:10"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  \n    at Module.load "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("node:internal/modules/cjs/loader:981:32"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("为了修复它，我们需要先手动构建 "),a("code",[s._v("shared-ui")]),s._v("。通常你希望避免如此操作，这就是 Nx 为什么定义了 "),a("code",[s._v("targetDefaults")]),s._v("（通常也称为“构建管道”） 的原因。")]),s._v(" "),a("p",[s._v("作为第一个依赖项，我们希望定义当我们在一个项目进行目标构建时，构建目标所依赖的所有项目都应该先执行。我们可以在 "),a("code",[s._v("build")]),s._v(" 任务定义处新增一个 "),a("code",[s._v("dependsOn")]),s._v(" 属性。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tasksRunnerOptions"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"targetDefaults"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"build"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dependsOn"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^build"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("与我们在 "),a("code",[s._v("inputs")]),s._v(" 的定义中看到的类似，这里的 "),a("code",[s._v("^")]),s._v(" 表示目标应该在所有相关的项目上运行。如果删除 "),a("code",[s._v("^")]),s._v("，那么将在相同的项目上调用目标。如果您有一个总是需要调用 "),a("code",[s._v("prebuild")]),s._v(" 步骤的项目，那么这将非常有用。")]),s._v(" "),a("p",[s._v("下一步，我们同样希望对我们的 Remix "),a("code",[s._v("dev")]),s._v(" 命令定义一个 targetDefault，就像 "),a("code",[s._v("build")]),s._v(" 命令运行之前所有依赖的包（即 "),a("code",[s._v("shared-ui")]),s._v("）会运行。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tasksRunnerOptions"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"targetDefaults"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"build"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dependsOn"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^build"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dev"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dependsOn"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^build"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[s._v("下面是完整的 "),a("code",[s._v("nx.json")]),s._v(" 文件：")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"tasksRunnerOptions"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"default"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"runner"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nx/tasks-runners/default"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"options"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"cacheableOperations"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"build"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"namedInputs"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"noMarkdown"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"!{projectRoot}/**/*.md"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"targetDefaults"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"build"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"inputs"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"noMarkdown"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^noMarkdown"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"dependsOn"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^build"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"dev"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"dependsOn"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^build"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("p",[s._v("如果我们现在运行 "),a("code",[s._v("npx nx build my-remix-app")]),s._v(",我们可以看到 Nx 首先运行依赖项目上的任务,然后才运行我们调用的命令。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/fengnzl/HexoImages/master/blog/20221003233123.png",alt:"dependsOn"}})]),s._v(" "),a("h2",{attrs:{id:"只有变化才运行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#只有变化才运行"}},[s._v("#")]),s._v(" 只有变化才运行")]),s._v(" "),a("p",[s._v("除了提供缓存，Nx 同时也允许使用所谓的 “"),a("a",{attrs:{href:"https://nx.dev/concepts/affected",target:"_blank",rel:"noopener noreferrer"}},[s._v("affected command"),a("OutboundLink")],1),s._v("“ 在给定的基准分之发生变化时执行。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("❯ npx nx affected:"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("target"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("你可以使用工作区中定义的任何目标。例如")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("npx nx affected:build")])]),s._v(" "),a("li",[a("code",[s._v("npx nx affected:test")])]),s._v(" "),a("li",[a("code",[s._v("npx nx affected:lint")])]),s._v(" "),a("li",[a("code",[s._v("npx nx affected:publish")])])]),s._v(" "),a("p",[a("strong",[s._v("这是如何运作的？")]),s._v(" Nx 基于 monorepo 工作区中包之间的结构和依赖关系构建了一个项目图，让我们假设是下面的图：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/fengnzl/HexoImages/master/blog/20221003234925.png",alt:"project-graph"}})]),s._v(" "),a("p",[s._v("当我们在某个分支运行 affected 命令，Nx 将所有的提交即相应的更改于基准分支进行比较。默认基准分支是 "),a("code",[s._v("main")]),s._v("，但是你可以在 "),a("code",[s._v("nx.json")]),s._v(" 文件中进行设置：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"affected"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"defaultBase"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"main"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("如果 "),a("code",[s._v("lib2")]),s._v(" 在特性分支上发生了变化，在工作区运行测试命令 "),a("code",[s._v("affected:test")]),s._v("，那么只会运行 "),a("code",[s._v("lib2")]),s._v(" 和 "),a("code",[s._v("appB")]),s._v(" 上面的测试。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/fengnzl/HexoImages/master/blog/20221003235400.png",alt:"affected-test"}})]),s._v(" "),a("p",[s._v("但是要注意，如果我们运行 "),a("code",[s._v("affected:build")]),s._v(" 命令，并且在 "),a("code",[s._v("nx.json")]),s._v(" 中定义了一个依赖的项目需要首先构建(参见 “定义任务依赖” 部分)，那么 "),a("code",[s._v("affected:build")]),s._v(" 命令将会构建：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("lib3")])]),s._v(" "),a("li",[a("code",[s._v("lib2")])]),s._v(" "),a("li",[a("code",[s._v("appB")])])]),s._v(" "),a("p",[s._v("它将不会构建 "),a("code",[s._v("lib1")]),s._v(" 和 "),a("code",[s._v("appA")]),s._v("。")]),s._v(" "),a("h2",{attrs:{id:"额外功能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#额外功能"}},[s._v("#")]),s._v(" 额外功能")]),s._v(" "),a("p",[s._v("除了速度和任务调度方面的改进，我们还通过将 Nx 添加到 PNPM 工作区中获得了一些额外的功能。让我们来探索一下。")]),s._v(" "),a("h2",{attrs:{id:"动态终端输出"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#动态终端输出"}},[s._v("#")]),s._v(" 动态终端输出")]),s._v(" "),a("p",[s._v("PNPM 并行运行任务会导致相当混乱的终端输出。日志很难解析，因为并行执行的不同命令的消息是交错的。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("❯ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("pnpm")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--parallel")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-r")]),s._v(" build\nScope: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" of "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" workspace projects\napps/my-remix-app build$ remix build\npackages/shared-ui build$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rf")]),s._v(" dist "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" tsc\napps/my-remix-app build: Building Remix app "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" production mode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\napps/my-remix-app build: The path "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"shared-ui"')]),s._v(" is imported "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" app/routes/index.tsx but shared-ui is not listed "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" your package.json dependencies. Did you forget to "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" it?\napps/my-remix-app build: Built "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" 176ms\napps/my-remix-app build: Done\npackages/shared-ui build: Done\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("当使用 Nx 运行任务时,你会得到一个动态终端,它只显示必要的和与当前执行的命令最相关的内容。在使用 Nx 时,运行相同的并行构建任务会得到以下输出：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://miro.medium.com/max/1400/1*GbaJL87ZfOpBQm-W6lBheQ.gif",alt:"build-parallel"}})]),s._v(" "),a("h2",{attrs:{id:"项目图表可视化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#项目图表可视化"}},[s._v("#")]),s._v(" 项目图表可视化")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("❯ npx nx graph\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("这加载了工作区的项目图的可视化交互，具有一些高级过滤，调试工作区结构等高级功能")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/fengnzl/HexoImages/master/blog/20221004001155.png",alt:"project-graph"}})]),s._v(" "),a("blockquote",[a("p",[s._v("作为旁注：你可以在任意的 PNPM 工作区运行项目图表，即使你没有安装 Nx，运行 "),a("code",[s._v("npx nx graph")]),s._v(" 应该会起作用。")])]),s._v(" "),a("h2",{attrs:{id:"结论"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#结论"}},[s._v("#")]),s._v(" 结论")]),s._v(" "),a("p",[s._v("我们做到了！下面是我们所覆盖到的一些知识：")]),s._v(" "),a("ul",[a("li",[s._v("如何基于 monorepo 工作区设置 PNPM")]),s._v(" "),a("li",[s._v("在 PNPM monorepo 中创建一个 Remix 应用和 React 库")]),s._v(" "),a("li",[s._v("如何运行不同的 PNPM 命令")]),s._v(" "),a("li",[s._v("如何添加 Nx 并在 monorepo 中逐步使用")]),s._v(" "),a("li",[s._v("在 PNPM monorepo 中添加 Nx 的好处及功能")])]),s._v(" "),a("p",[s._v("你可以在 "),a("a",{attrs:{href:"https://github.com/nrwl/nx-recipes/tree/main/pnpm-workspace",target:"_blank",rel:"noopener noreferrer"}},[s._v("Nx Recipe GitHub"),a("OutboundLink")],1),s._v(" 仓库中找到上述设置的例子。")])])}),[],!1,null,null,null);a.default=e.exports}}]);